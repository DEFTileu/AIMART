{% load static %} {% load custom_filters %}

<div class="product-grid {% if grid_class %}{{ grid_class }}{% endif %}">
  {% if products %} {% for product in products %} {% include 'html/components/product_card.html' with product=product show_discount=show_discount|default:True show_rating=show_rating|default:True show_seller=show_seller|default:False show_category=show_category|default:False show_quick_view=show_quick_view|default:False is_favorite=product.id|in_favorites:request.user additional_class=product_card_class|default:"" is_seller_view=is_seller_view|default:False %} {% endfor %} {% else %}
  <div class="empty-products">
    <div class="empty-content">
      <div class="empty-icon">
        {% if empty_icon %} {{ empty_icon|safe }} {% else %} üîç {% endif %}
      </div>

      <h3 class="empty-title">
        {% if empty_title %} {{ empty_title }} {% else %} –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã {%endif %}
      </h3>

      <p class="empty-message">
        {% if empty_message %} {{ empty_message }} {% else %} –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ
        –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        –ø–æ–∏—Å–∫–∞. {% endif %}
      </p>

      {% if empty_action_url %}
      <a href="{{ empty_action_url }}" class="empty-action-btn">
        {{ empty_action_text|default:"–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥" }}
      </a>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>

<style>
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
  }

  .product-grid.compact {
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
  }

  .product-grid.list {
    grid-template-columns: 1fr;
    gap: 15px;
  }

  .empty-products {
    grid-column: 1 / -1;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
    padding: 40px 20px;
    text-align: center;
  }

  .empty-content {
    max-width: 500px;
    margin: 0 auto;
  }

  .empty-icon {
    font-size: 50px;
    margin-bottom: 20px;
    color: #ccc;
  }

  .empty-title {
    font-size: 24px;
    color: #333;
    margin-bottom: 15px;
  }

  .empty-message {
    color: #666;
    line-height: 1.5;
    margin-bottom: 25px;
  }

  .empty-action-btn {
    display: inline-block;
    background: #ff8c00;
    color: white;
    padding: 12px 25px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
    transition: background 0.3s;
  }

  .empty-action-btn:hover {
    background: #e67e00;
  }

  @media (max-width: 768px) {
    .product-grid {
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
    }

    .product-grid.compact {
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
    }
  }

  @media (max-width: 480px) {
    .product-grid {
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
    }

    .product-grid.compact {
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 8px;
    }
  }

  /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–µ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ */
  .product-grid .product-card {
    height: 100%;
    transform-origin: center bottom;
    transform: translateY(0);
    transition: transform 0.3s, box-shadow 0.3s;
    animation: fadeIn 0.5s ease;
  }

  .product-grid .product-card:hover {
    transform: translateY(-7px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
  }

  /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(15px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ */
  .cart-counter,
  .favorites-counter {
    transition: transform 0.3s, background-color 0.3s;
  }

  .cart-updated,
  .counter-updated {
    transform: scale(1.3);
    background-color: #ff8c00 !important;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    if ("IntersectionObserver" in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const img = entry.target;
            const src = img.getAttribute("data-src");
            if (src) {
              img.src = src;
              img.removeAttribute("data-src");
            }
            observer.unobserve(img);
          }
        });
      });

      document.querySelectorAll("img.product-image").forEach((img) => {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π src –≤ data-src –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
        const originalSrc = img.getAttribute("src");
        if (
          originalSrc &&
          !img.hasAttribute("data-src") &&
          !originalSrc.includes("no-image.jpg")
        ) {
          img.setAttribute("data-src", originalSrc);
          img.src = "{% static 'images/placeholder.jpg' %}";
          imageObserver.observe(img);
        }
      });
    }
  });
</script>
